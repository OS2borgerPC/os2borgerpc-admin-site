# This file was auto-generated by BibOS. Not that this file does not use
# the acl dirs from the original squid-deb-proxy package

acl allowed_networks src 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
acl allowed_hosts dstdomain {{ allowed_hosts|join:' ' }}
{% if direct_hosts %}
acl direct_hosts dstdomain {{ direct_hosts|join:' ' }}
{% endif %}

http_port 8000

visible_hostname squid-deb-proxy

maximum_object_size 512 MB

# use a different dir than stock squid and default to 40G
cache_dir aufs /var/cache/squid-deb-proxy 40000 16 256

# use different logs
cache_access_log /var/log/squid-deb-proxy/access.log
cache_log /var/log/squid-deb-proxy/cache.log
cache_store_log /var/log/squid-deb-proxy/store.log

# tweaks to speed things up
cache_mem 200 MB
maximum_object_size_in_memory 10240 KB

# pid
pid_filename /var/run/squid-deb-proxy.pid

# refresh pattern for debs and udebs
refresh_pattern deb$   129600 100% 129600
refresh_pattern udeb$   129600 100% 129600
refresh_pattern tar.gz$  129600 100% 129600

# always refresh Packages and Release files
refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz)$ 0 0% 0
refresh_pattern \/Release(|\.gpg)$ 0 0% 0

# handle meta-release and changelogs.ubuntu.com special
refresh_pattern changelogs.ubuntu.com/*  0  1% 1

# default acl
acl all src all
acl localhost src 127.0.0.1/32

# only allow connects to ports for http, https, hkp
acl Safe_ports port 80
acl Safe_ports port 443 563   
acl Safe_ports port 11371

# only allow ports we trust
http_access deny !Safe_ports

# allow access only to official ubuntu mirrors
# uncomment the third and fouth line to permit any unlisted domain
http_access deny !allowed_hosts
http_access allow allowed_hosts

# allow access from our network and localhost
http_access allow allowed_networks

# And finally deny all other access to this proxy
http_access deny all

cache_peer {{ upstream_host }} parent {{ upstream_port }} 0 login={{ login }}:{{ password }} no-query no-digest no-netdb-exchange default
{% if direct_hosts %}
always_direct allow direct_hosts
{% endif %}
never_direct allow all
