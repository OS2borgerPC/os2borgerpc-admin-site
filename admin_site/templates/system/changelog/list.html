{% extends site_extension %}

{% block header_title %}

{% if site %}
{{site}}: Nyheder
{% else %}
OS2borgerPC: Nyheder
{% endif %}
{% endblock %}

{% block stylesheets %}
    <link href="/static/css/changelog.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/foundation.min.css">
{% endblock %}

{% block head_javascripts %}    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>
    <script type="text/javascript" src="/static/js/changelog_list.js"></script>
{% endblock %}


{% block globalnav %}
    {% if global_view %}
        <nav id="left-menu" class="nav nav-pills utils-global">
            <h2 class="text-light">Nyheder</h2>
            <a href="/" class="nav-link link-light d-flex align-items-center">
                <span class="material-icons" style="margin: 0 .25rem 0 -.25rem; font-size: 1.25rem;">arrow_back</span>
                Tilbage til login
            </a>
            <hr>
            <h2 class="text-light">Dokumentation</h2>
            <a href="{% url 'doc' 'changelogs' %}" class="nav-link link-light">
                <span class="material-icons">help_outline</span>
                Hjælp til nyhedssiden
              </a>
        </nav>
    {% endif %}
    {{ block.super }}
{% endblock %}


{% block specific_content %}

<div class="filtersearch">
    <form action="">
        <div class="input-group">
            <span class="input-group-text bg-white">
                <span class="material-icons">search</span>
                <input type="search" id="search" name="search" class="form-control" style="border: 0" placeholder="Søg...">
            </span>
        </div>
    </form>
</div>

<div id="changelog-container">
    <header>
        <strong id="tags-title" class="text-muted">Nyhedskategorier</strong>

       <!-- Here the tag filters are defined. Each is a clickable button that filters the entries to show entries with that tag -->
        <form method="GET">
            <div id="changelogsearch-tag-selectors">
                <a href=""><button class="btn btn-md tag-filter-btn bg-primary text-white me-2" id="Alle" type="submit">Alle</button></a>
                {% for tag in tag_choices %}
                    <a href="?{% if page %}page={{ page }}&{% endif %}tag={{ tag.pk }}"><button class="btn btn-md tag-filter-btn bg-primary text-white me-2" id="{{ tag.pk }}" type="button" name="{{ tag.id }}">{{ tag.name }}</button></a>
                {% endfor %}
            </div>
        </form>
    </header>

    <div class="changelog-container">
        <h3>
            {% if tag_filter %}
                Viser {{ tag_filter.name }} opdateringer
            {% else %}
                Viser alle opdateringer
            {% endif %}
        </h3>
        {% for entry in entries %}
        <div class="changelogitem" id="changelog-{{ entry.pk }}">   
            <div class="card" style="padding: 1rem;">
                <strong class="timestamp-created text-muted">{{ entry.created }}</strong>
                <h2 class="card-title">
                    {{ entry.title }}
                </h2>
                <p>
                    {{ entry.description }}
                </p>
                <button
                  class="btn"
                  data-bs-target="#changelogDetails-{{ entry.pk }}"
                  type="button"
                  data-bs-toggle="modal"
                  title="show more">
                    <p><span class="material-icons">read_more</span>Læs mere <br>{{ entry.comments.count }} <span class="material-icons">chat</span></p>
                </button>
            </div>
        </div>

        {% include "system/changelog/item.html" with entry=entry %}

        {% endfor %}
    </div>


    <!-- pagination start -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if entries.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ entries.previous_page_number }}{% if tag_filter.pk %}&tag={{ tag_filter.pk }}{% endif%}">Forrige</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Forrige</a>
                </li>
            {% endif %}

            {% if entries.number|add:'-4' > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ entries.number|add:'-5' }}{% if tag_filter.pk %}&tag={{ tag_filter.pk }}{% endif%}">&hellip;</a>
                </li>
            {% endif %}

            {% for i in entries.paginator.page_range %}
                {% if entries.number == i %}
                    <li class="page-item active" aria-current="page">
                        <span class="page-link">
                            {{ i }}
                        </span>
                    </li>
                {% elif i > entries.number|add:'-5' and i < entries.number|add:'5' %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ i }}{% if tag_filter.pk %}&tag={{ tag_filter.pk }}{% endif%}">{{ i }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if entries.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ entries.next_page_number }}{% if tag_filter.pk %}&tag={{ tag_filter.pk }}{% endif%}">Næste</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Næste</a>
                </li>
            {% endif %}
        </ul>
    </nav>
    <!-- pagination end -->
    {% endblock %}
